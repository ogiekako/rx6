2018-06-10

今日は、17:00 までに Bcache を書ききるのが目標。Bcache は buffer cache の略で

あまり難しいことはやりすぎないで、lock の下に構造体を置く以外はなるべくもとの構造を残していこう。

Bcache は sleep lock がからんでいてややこしいので、まずは ptable を実装すべき気がしてきた。
とくに、wakeup をよべるくらいまでのところまでいきたい。

2018-06-05
Bcache の buf: [Buf; NBUF] を initialize する方法を探していたけど、lazy_static を使うしかなさそうだった。
new の中で unsafe な方法を使って、適当に memory を割り当てて、一旦それができてしまえば、永久に生き続けることにしていい。
明日は、lazy_static を使って、bcache を同じ構造で初期化するところまでを目標にしよう。
lazy_static という外部ライブラリを使うのは一旦は気持ち悪いけどおいておこう。ゆくゆくは自分のもので書きたいけど、優先度は低い.

2018-05-27

やっぱり lock をちゃんと実装しよう。そうしないとデータ構造が曖昧になって気持ち悪い。

spinlock を使って、lock data structure を作るのが今日も目標。

2018-05-26

trap を実装しようとしていたけど、実際は、kernmain から呼ばれるのは、tvinit だけで、trap 自体は今の所実行されない。
なので、trap を実装するのは一旦おいておいて、kernmain から実行される本筋のところを実装していこう。


TODO: lock
はあとまわし。

bio::binit は、buffer cache の実装
これは、disk への書き込みが遅いので、それを隠蔽するためのインメモリキャッシュである。

bread()

memide.c は、インメモリファイルシステムを構成する。
qemu-nox では、ide.c を使っている。いまのところ、ide.c に準拠することにする。

